name: "Solhint CI"

on: [push, pull_request]

env:
  NODE_VER: 16
jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 16
      - run: |
          echo -n "Node version: "
          node -v
          echo -n "Npm version: "
          npm -v
          npm i
      - name: solhint
        id: solhint
        run: |
          set -o pipefail
          set +e
          npx -y solhint --init
          echo -e 'solhint result for ${{ github.sha }}:\n```' > solhint.md
          npx -y solhint --ignore-path 'node_modules' '**/*.sol' | tee -a solhint.md
          exit_code=$?
          echo '```' >> solhint.md
          exit ${exit_code}
      - name: Comment PR for solhint
        uses: thollander/actions-comment-pull-request@v2
        if: github.event_name == 'pull_request' && (success() || failure())
        with:
          filePath: "solhint.md"
